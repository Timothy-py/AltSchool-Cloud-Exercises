---

- hosts: all
  become: true
  tasks:
          - name: install updates on ubuntu server
            tags: update
            apt:
                    upgrade: dist
                    force_apt_get: yes
                    update_cache: yes

          - name: install apache and php packages for ubuntu server
            tags: ubuntu,apache,php
            apt:
                    name:
                            - apache2
                            - libapache2-mod-php
                    state: latest

          - name: enable ufw
            tags: ufw,service
            community.general.ufw:
                    state: enabled

          - name: start ufw service
            service:
                    name: ufw
                    state: started

          - name: Allow Apache Full
            community.general.ufw:
                    rule: allow
                    name: Apache Full
          - name: Allow OpenSSH
            community.general.ufw:
                    rule: allow
                    name: OpenSSH

          - name: Install PHP and Modules
            apt:
                    name:
                            - "{{item}}"
                    update_cache: yes
                    state: latest
            with_items:
                    - php8.1-cli 
                    - php8.1-common 
                    - php8.1-zip 
                    - php8.1-gd 
                    - php8.1-mbstring 
                    - php8.1-curl 
                    - php8.1-xml
                    - php8.1-bcmath


          - name: create project directory
            file:
                    path: /var/www/timothy
                    state: directory
                    #owner: www-data
                    #group: www-data
                    #omode: '0700'
                     
          - name: Clone git repository
            git:
                    repo: https://github.com/f1amy/laravel-realworld-example-app.git
                    dest: /var/www/timothy
                    clone: yes
                    update: no
